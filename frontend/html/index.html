<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./../static/home.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Canteen Feedback</title>
</head>

<body>
    <div id="alert_box" class="fixed top-0 left-0 flex-col flex m-2 bg-white opacity-0 w-[20rem]">
        <p class="m-2"></p>
        <div class="h-[5px] w-0 
        bg-green-400 transition-all duration-[4s]"></div>
    </div>
    <header class="flex-header">
        <a href="{{url_for('get_review')}}"><button class="review-button">Write a Review</button></a>
        {% if user.is_authenticated %}
        <a href="{{url_for('logout')}}"><button class="review-button">Logout</button></a>
        <div class="avatar">
            <img src={{user.profile_url}}
                alt="Avatar">
        </div>
        {% else %}
        <a href="{{url_for('login')}}"><button class="review-button">Login</button></a>
        {% endif %}
    </header>
    <div class="content">
        <section class="main-content">
            <div class="search-container">
                <input type="text" placeholder="Search for your canteen..." id="search_item" class="">
                <button class="search-button" onclick="search()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none" />
                        <path
                            d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.76-2.86-5-5.64-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.78 2.58 5.17 5.34 5.64a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25a1 1 0 0 0 1.41-1.41L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
                    </svg>
                </button>
            </div>
            <div class="dropdown" id="searchDropdown">
                <div class="dropdown-content" id="searchResults">
                    <!-- Search results will be displayed here -->
                </div>
            </div>
            <div class="response">
                
                <article class="blog-post">
                    <h1 class="post-title">Lorem Ipsum Dolor Sit Amet</h1>
                    <div class="post-content">
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum scelerisque imperdiet
                            fermentum. Curabitur in ligula vitae lectus rhoncus tristique. Nullam efficitur, erat nec
                            convallis cursus, justo purus feugiat erat, eu cursus nisl eros in justo.
                        </p>

                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSKbdJk2tGJf5owybQvU3jwOv679c6uYi1-pA&usqp=CAU"
                            alt="Image description">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSKbdJk2tGJf5owybQvU3jwOv679c6uYi1-pA&usqp=CAU"
                            alt="Image description">

                        <p>
                            Sed vulputate, massa nec ultricies tristique, elit est eleifend velit, nec convallis massa
                            nunc id nisi. Proin sollicitudin nec justo vel bibendum. Morbi efficitur justo ut est
                            cursus, vitae lobortis ligula lacinia. Vestibulum nec metus vehicula, blandit odio a, dictum
                            sapien.
                        </p>

                        <p>
                            Integer euismod sapien vel ipsum scelerisque, a interdum elit tristique. Sed vulputate
                            ligula a neque volutpat, ut rhoncus justo pellentesque. Aenean volutpat ligula eget ultrices
                            cursus. Nullam auctor varius purus, sit amet cursus ex vestibulum in.
                        </p>
                        <p>
                            Sed vulputate, massa nec ultricies tristique, elit est eleifend velit, nec convallis massa
                            nunc id nisi. Proin sollicitudin nec justo vel bibendum. Morbi efficitur justo ut est
                            cursus, vitae lobortis ligula lacinia. Vestibulum nec metus vehicula, blandit odio a, dictum
                            sapien.
                        </p>

                        <p>
                            Integer euismod sapien vel ipsum scelerisque, a interdum elit tristique. Sed vulputate
                            ligula a neque volutpat, ut rhoncus justo pellentesque. Aenean volutpat ligula eget ultrices
                            cursus. Nullam auctor varius purus, sit amet cursus ex vestibulum in.
                        </p>
                        <p>
                            Sed vulputate, massa nec ultricies tristique, elit est eleifend velit, nec convallis massa
                            nunc id nisi. Proin sollicitudin nec justo vel bibendum. Morbi efficitur justo ut est
                            cursus, vitae lobortis ligula lacinia. Vestibulum nec metus vehicula, blandit odio a, dictum
                            sapien.
                        </p>

                        <p>
                            Integer euismod sapien vel ipsum scelerisque, a interdum elit tristique. Sed vulputate
                            ligula a neque volutpat, ut rhoncus justo pellentesque. Aenean volutpat ligula eget ultrices
                            cursus. Nullam auctor varius purus, sit amet cursus ex vestibulum in.
                        </p>
                    </div>
                </article>


                <!-- for top queries -->
                <!-- <section class="hot-topics">
                    <h2>Top Queries</h2>
                    <ul>
                        <li>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Blanditiis quibusdam repellendus voluptatem qui error, numquam at possimus amet totam recusandae laboriosam quia! Debitis, maiores voluptatibus ipsa dolorum ipsam totam dicta temporibus inventore quis illum asperiores reiciendis nihil qui saepe iste dignissimos error consequuntur. Sed voluptas nesciunt soluta modi qui laborum!</li>
                        <li>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Blanditiis quibusdam repellendus voluptatem qui error, numquam at possimus amet totam recusandae laboriosam quia! Debitis, maiores voluptatibus ipsa dolorum ipsam totam dicta temporibus inventore quis illum asperiores reiciendis nihil qui saepe iste dignissimos error consequuntur. Sed voluptas nesciunt soluta modi qui laborum!</li>
                        <li>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Blanditiis quibusdam repellendus voluptatem qui error, numquam at possimus amet totam recusandae laboriosam quia! Debitis, maiores voluptatibus ipsa dolorum ipsam totam dicta temporibus inventore quis illum asperiores reiciendis nihil qui saepe iste dignissimos error consequuntur. Sed voluptas nesciunt soluta modi qui laborum!</li>
                        
                    </ul>
                </section> -->
            </div>
        </section>
        <section class="hot-topics">
            <h2>Hot Topics</h2>
            <ul>
                <li>Non-veg Noodles</li>
                <li>Veg Noodles</li>
                <li>Maggi</li>
                <li>Panipuri</li>
                <li>Sandwich</li>
                <li>Chiken Roll</li>
                <li>Veg Roll</li>
                <li>Coffee</li>
                <li>Ice tea</li>
                <li>Tea</li>
                <li>Fruit Juice</li>
            </ul>
        </section>
    </div>
    <footer>
        <p>&copy; 2023 Your Website</p>
    </footer>
</body>
<script type="text/javascript">
    search_item = document.getElementById("search_item")

    var item_list = {{ item_list | safe}}


    function jaccardSimilarity(word1, word2) {
        const set1 = new Set(word1.split(''));
        const set2 = new Set(word2.split(''));

        const intersection = new Set([...set1].filter(char => set2.has(char)));
        const union = new Set([...set1, ...set2]);

        return intersection.size / union.size;
    }


    data = []
    search_item.addEventListener("keyup", () => {


        for (let i = 0; i < item_list.length; i++) {
            similarity = jaccardSimilarity(item_list[i], search_item.value)
            if (similarity > .4) {
                data.push(item_list[i])
            }
        }
        const searchResults = document.getElementById("searchResults");
        searchResults.innerHTML = ""
        if (search_item.value == "") {
            searchResults.style.display = "none"
            data = []
            return
        }
        if (data.length > 0) {
            data.forEach(item => {
                const result = document.createElement("a");
                result.textContent = item;
                searchResults.appendChild(result);
            });
            searchResults.style.display = "block"
        } else {
            searchResults.style.display = "none"
        }
    })

    //     const data = [
    //     "Modeling",
    //     "Simulation",
    //     "Machine Learning",
    //     "Control Systems",
    //     "Artificial Intelligence",
    //     "Reinforcement Learning",
    //     "Optimization"
    //     // Add more items as needed
    // ];

    function search() {
        const searchTerm = document.getElementById("search_item").value.toLowerCase();

        if(item_list.indexOf(searchTerm) === -1) {
            showAlert("Item not present")
        }

        $.ajax({
            type: "POST",
            url: "/process_qtc",
            data: JSON.stringify([{"item_name": searchTerm}]),
            contentType: "application/json",
            dataType: 'json',
            success: function (result) {
                numRows.innerHTML = result.rows;
            }
        });

        const searchResults = document.getElementById("searchResults");
        searchResults.innerHTML = ""; // Clear previous results
        if (searchTerm == "") {
            searchResults.style.display = "none"
            return
        }
        const filteredData = data.filter(item => item.toLowerCase().includes(searchTerm));



        if (filteredData.length === 0) {
            const noResults = document.createElement("a");
            noResults.textContent = "No results found.";
            searchResults.appendChild(noResults);
        } else {
            filteredData.forEach(item => {
                const result = document.createElement("a");
                result.textContent = item;
                searchResults.appendChild(result);
            });
            searchResults.style.display = "block"
        }
    }
    // for showing alert
    showAlert = (msg) => {
            alert_box.firstElementChild.innerText = msg;
            alert_box.classList.replace("opacity-0", "opacity-100");
            alert_box.firstElementChild.nextElementSibling.classList.add("w-full");


            setTimeout(() => {
                alert_box.classList.replace("opacity-100", "opacity-0");
                alert_box.firstElementChild.nextElementSibling.classList.remove("w-full")
            }, 4000)
        }

</script>
<!-- <script src="../static/scripts/recommend.js"></script> -->

</html>