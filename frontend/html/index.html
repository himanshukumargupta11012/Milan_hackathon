<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./../static/home.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Canteen Feedback</title>
</head>

<body>
    <div id="alert_box" class="fixed top-0 left-0 flex-col flex m-2 bg-white opacity-0 w-[20rem]">
        <p class="m-2"></p>
        <div class="h-[5px] w-0 
        bg-green-400 transition-all duration-[4s]"></div>
    </div>
    <header class="flex-header">
        <img src="./../static/raman.jpeg" alt="Avatar" width="50" height="50" style="margin-left: 1.5rem; border-radius: 50%;">
        <div class="flex">
            <a href="{{url_for('get_review')}}"><button class="review-button">Write a Review</button></a>
            {% if user.is_authenticated %}
            <a href="{{url_for('logout')}}"><button class="review-button">Logout</button></a>
            <div class="avatar">
                <img src={{user.profile_url}} alt="Avatar">
            </div>
            {% else %}
            <a href="{{url_for('login')}}"><button class="review-button">Login</button></a>
            {% endif %}
        </div>
       
    </header>
    <div class="content">
        <section class="main-content">
            <div class="search-container">
                <input type="text" placeholder="Search for your canteen..." id="search_item">
                <button class="search-button" onclick="search()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none" />
                        <path
                            d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.76-2.86-5-5.64-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.78 2.58 5.17 5.34 5.64a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25a1 1 0 0 0 1.41-1.41L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
                    </svg>
                </button>
            </div>
            <div class="dropdown" id="searchDropdown">
                <div class="dropdown-content" id="searchResults">
                    <!-- Search results will be displayed here -->
                </div>
            </div>

            <!-- canva for drawing the graphs -->
            <div class="response">
                <div class="flex">
                    <div class="chart-container" style="position: relative;  width: 500px;">
                        <canvas id="myChart"></canvas>
                    </div>

                    <div class="chart-container" style="position: relative;  width: 500px;">
                        <canvas id="lineplot"></canvas>
                    </div>
                </div>

                <span id="spac"></span>
                <!-- for top queries -->
                <!-- <section class="hot-topics">
                    <h2>Top Queries</h2>
                    <ul>
                        <li>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Blanditiis quibusdam repellendus voluptatem qui error, numquam at possimus amet totam recusandae laboriosam quia! Debitis, maiores voluptatibus ipsa dolorum ipsam totam dicta temporibus inventore quis illum asperiores reiciendis nihil qui saepe iste dignissimos error consequuntur. Sed voluptas nesciunt soluta modi qui laborum!</li>
                        <li>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Blanditiis quibusdam repellendus voluptatem qui error, numquam at possimus amet totam recusandae laboriosam quia! Debitis, maiores voluptatibus ipsa dolorum ipsam totam dicta temporibus inventore quis illum asperiores reiciendis nihil qui saepe iste dignissimos error consequuntur. Sed voluptas nesciunt soluta modi qui laborum!</li>
                        <li>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Blanditiis quibusdam repellendus voluptatem qui error, numquam at possimus amet totam recusandae laboriosam quia! Debitis, maiores voluptatibus ipsa dolorum ipsam totam dicta temporibus inventore quis illum asperiores reiciendis nihil qui saepe iste dignissimos error consequuntur. Sed voluptas nesciunt soluta modi qui laborum!</li>
                        
                    </ul>
                </section> -->
            </div>
        </section>
        <section class="hot-topics">
            <h2>Hot Topics</h2>
            <ul>
                <li>Non-veg Noodles</li>
                <li>Veg Noodles</li>
                <li>Maggi</li>
                <li>Panipuri</li>
                <li>Sandwich</li>
                <li>Chiken Roll</li>
                <li>Veg Roll</li>
                <li>Coffee</li>
                <li>Ice tea</li>
                <li>Tea</li>
                <li>Fruit Juice</li>
            </ul>
        </section>
    </div>
    <footer>
        <p>&copy; Milan Hackthon 2023 From Raman Block</p>
    </footer>
</body>
<script type="text/javascript">
    search_item = document.getElementById("search_item")
    let canva = document.getElementsByClassName("canva")
    canva.width = 400
    canva.height = 300

    var item_list = {{ item_list | safe}}


    function jaccardSimilarity(word1, word2) {
        const set1 = new Set(word1.split(''));
        const set2 = new Set(word2.split(''));

        const intersection = new Set([...set1].filter(char => set2.has(char)));
        const union = new Set([...set1, ...set2]);

        return intersection.size / union.size;
    }


    data = []
    search_item.addEventListener("keyup", () => {


        for (let i = 0; i < item_list.length; i++) {
            similarity = jaccardSimilarity(item_list[i], search_item.value)
            if (similarity > .4) {
                data.push(item_list[i])
            }
        }
        const searchResults = document.getElementById("searchResults");
        searchResults.innerHTML = ""
        if (search_item.value == "") {
            searchResults.style.display = "none"
            data = []
            return
        }
        if (data.length > 0) {
            data.forEach(item => {
                const result = document.createElement("a");
                result.textContent = item;
                searchResults.appendChild(result);
            });
            searchResults.style.display = "block"
        } else {
            searchResults.style.display = "none"
        }
    })

    function search() {
        const searchTerm = document.getElementById("search_item").value.toLowerCase();

        if(item_list.indexOf(searchTerm) === -1) {
            showAlert("Item not present")
        }

        $.ajax({
            type: "POST",
            url: "/search",
            data: JSON.stringify([{"item_name": searchTerm}]),
            contentType: "application/json",
            dataType: 'json',
            success: function (result) {
                console.log(result)
                spac.innerHTML = result.rows[0][1];
            }
        });

        const searchResults = document.getElementById("searchResults");
        searchResults.innerHTML = ""; // Clear previous results
        if (searchTerm == "") {
            searchResults.style.display = "none"
            return
        }
        const filteredData = data.filter(item => item.toLowerCase().includes(searchTerm));

        if (filteredData.length === 0) {
            const noResults = document.createElement("a");
            noResults.textContent = "No results found.";
            searchResults.appendChild(noResults);
        } else {
            filteredData.forEach(item => {
                const result = document.createElement("a");
                result.textContent = item;
                searchResults.appendChild(result);
            });
            searchResults.style.display = "block"
        }
    }
    // for showing alert
    showAlert = (msg) => {
            alert_box.firstElementChild.innerText = msg;
            alert_box.classList.replace("opacity-0", "opacity-100");
            alert_box.firstElementChild.nextElementSibling.classList.add("w-full");


            setTimeout(() => {
                alert_box.classList.replace("opacity-100", "opacity-0");
                alert_box.firstElementChild.nextElementSibling.classList.remove("w-full")
            }, 4000)
        }

</script>
<!-- <script src="../static/scripts/recommend.js"></script> -->

<script>
    var item = 'Maagi';
    const jsondatalineplot = { '50': 7, '60': 8, '70': 8, '80': 9, '90': 9, '100': 9, '110': 10, '120': 11, '130': 14, '140': 14, '150': 15 }
    function creatLineChart(data, item) {
        var ctx = document.getElementById('lineplot').getContext('2d');
        var xValues = Object.keys(data);
        var yValues = Object.values(data);
        const barColors = ["red", "green", "blue", "orange", "brown"];
        var lineplot = new Chart("lineplot", {
            type: "line",
            data: {
                labels: xValues,
                datasets: [{
                    fill: false,
                    lineTension: 0,
                    backgroundColor: "rgba(0,0,255,1.0)",
                    borderColor: "rgba(0,0,255,0.1)",
                    data: yValues
                }]
            },
            options: {
                legend: { display: false },
                title: {
                    display: true,
                    text: "Rating of " + item + " over last few days"
                },
                legend: { display: false },
                scales: {
                    yAxes: [{ ticks: { min: 6, max: 16 } }],
                }
            }
        });
    }
    creatLineChart(jsondatalineplot, item)
</script>

<!-- Call the function to generate the chart -->
<script>
    // JSON data
    var jsonData = { 'Maggi': 9, 'Veg Noodles': 4, 'Lemon Ice Tea': 7.5, 'Pav Bhaji': 6, 'Pani Puri': 10 };

    // Function to create a bar chart
    function createBarChart(data) {
        var ctx = document.getElementById('myChart').getContext('2d');
        var labels = Object.keys(data);
        var values = Object.values(data);

        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Ratings',
                    data: values,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)', // Bar color
                    borderColor: 'rgba(75, 192, 192, 1)', // Border color
                    borderWidth: 2
                }],

            },
            options: {
                plugins: {
                    title: {
                        display: true, // Display the title
                        text: 'Ratings of Top 5 Food Items in the last week', // Title text
                        fontSize: 30 // Font size for the title
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            fontSize: 25 // Increase the font size for x-axis labels
                        }
                    },
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
    createBarChart(jsonData);
</script>

</html>